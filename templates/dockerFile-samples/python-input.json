{
  "dockerfile": [
    {
      "stage": 0,
      "instructions": [
        {
          "from": [
            "cgr.dev/chainguard/python:latest-dev As builder"
          ]
        },
        {
          "env": [
            "APP_HOME=/app"
          ]
        },
        {
          "run": [
            "useradd -m -s /bin/bash -d $APP_HOME myappuser"
          ]
        },
        {
          "workdir": [
            "$APP_HOME"
          ]
        },
        {
          "copy": [
            "requirements.txt $APP_HOME/"
          ]
        },
        {
          "run": [
            "pip install --no-cache-dir -r requirements.txt"
          ]
        },
        {
          "copy": [
            "src/ $APP_HOME/src/"
          ]
        }
      ]
    },
    {
      "stage": 1,
      "instructions": [
        {
          "from": [
            "cgr.dev/chainguard/static:latest"
          ]
        },
        {
          "env": [
            "APP_USER=myappuser",
            "APP_HOME=/app"
          ]
        },
        {
          "run": [
            "useradd -m -s /bin/bash -d $APP_HOME $APP_USER"
          ]
        },
        {
          "workdir": [
            "$APP_HOME"
          ]
        },
        {
          "copy": [
            "--from=builder $APP_HOME /usr/local/lib/python3.9/site-packages/"
          ]
        },
        {
          "copy": [
            "src/ $APP_HOME/src/"
          ]
        },
        {
          "user": [
            "$APP_USER"
          ]
        },
        {
          "cmd": [
            "python",
            "src/app.py"
          ]
        }
      ]
    }
  ]
}